#machine:
  #services:
    #- docker
  #ruby:
    #version: 2.3.1

dependencies:
  pre:
    # Don't need parallel true on these because parallel is implied for all
    # steps in dependency phase

    # Install dependencies on container 0 only
    - |
      if [[ $CIRCLE_NODE_INDEX = 0 ]]; then
        gem install bundler && bundle install ;
      else
        echo "This step skipped on this container" ;
      fi

    # Copy dependencies to containers 1-N
    - |
      if [[ $CIRCLE_NODE_INDEX != 0 ]]; then
        scp -r node0:"$HOME/$CIRCLE_PROJECT_REPONAME/vendor" $HOME/$CIRCLE_PROJECT_REPONAME/vendor

        # Sanity check dependencies registered properly
        cd $HOME/$CIRCLE_PROJECT_REPONAME && bundle check
      else
        echo "This step skipped on this container" ;
      fi

    #- sleep 550


test:
  override:
    #- sleep 550
    #- pkg-versions.sh
    - exit 0

#deployment:
  #test:
    #tag: /\d+\.\d+\.\d+/
    #commands:
      #- exit 0

  #test-with-dashes:
    #tag: /(?i).*-rc\d+/
    #commands:
      #- echo "test with dashes"


